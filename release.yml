version: 0.2
phases:
  build:
    commands:
      - echo $EKS_CLUSTER_NAME
      - echo $EKS_ROLE_ARN
      - curl https://helm-charts-tinystacks.s3.us-west-1.amazonaws.com/helm3.sh | bash -s -- --version v3.8.2
      - curl -LO https://dl.k8s.io/release/v1.22.0/bin/linux/amd64/kubectl
      - chmod +x kubectl && mv kubectl /usr/local/bin/
      - aws eks update-kubeconfig --name $EKS_CLUSTER_NAME --region $STAGE_REGION --role-arn $EKS_ROLE_ARN
      - helm upgrade --install $HELM_CHART $HELM_REPOSITORY$HELM_CHART-$HELM_VERSION.tgz
      - kubectl get pods